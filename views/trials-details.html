{% extends "layouts/two-columns.html" %}

{% block bannerFooter %}
  <ul class="overview-list">
    <li>
      <span class="date">
        Registration: {{ trial.registration_date | formatDate }}
      </span>
    </li>
  </ul>
{% endblock %}

{% block main %}


{% macro no_data_message(name, thing='', contribute='link-to-contribute') -%}
  <h2 class="disabled">{{ name }}</h2>
  <p class="disabled">
    We have no {{ thing }} for this trial. Help us by <a href="{{ contribute }}">contributing data</a>.
  </p>
{%- endmacro %}

<article>
  {% if trial.conditions.length != 0 %}
  <h2>Conditions</h2>
  <ul class="overview-list">
    {% for condition in trial.conditions %}
      <li><a href="/conditions/{{ condition.attributes.id }}">{{ condition.attributes.name }}</a></li>
    {% endfor %}
  </ul>
  {% else %}
  {{ no_data_message('Conditions', thing='"conditions" data') }}
  {% endif %}

  {% if trial.interventions.length != 0 %}
  <h2>Treatments</h2>
  <ul class="overview-list">
    {% for intervention in trial.interventions %}
      <li><a href="/interventions/{{ intervention.attributes.id }}">{{ intervention.attributes.name }}</a></li>
    {% endfor %}
  </ul>
  {% else %}
  {{ no_data_message('Treatments', thing='"treatment" data') }}
  {% endif %}

  {% if trial.brief_summary.length != 0 %}
  <h2>Lay summary</h2>
  <p>
    {{ trial.brief_summary }}
  </p>
  {% else %}
  {{ no_data_message('Lay summary', thing='"lay summary"') }}
  {% endif %}
</article>

<aside>
  <ul class="actions">
    <li>
      <a href="{{ trial.url }}" class="download">Download JSON</a>
      <a href="{{ contributeDataUrl }}" class="upload">Contribute Data</a>
    </li>
  </ul>

  {% if trial.locations.length != 0 %}
  <h2>Conducted in</h2>
  <dl>
    {% for location in trial.locations %}
      <dt>{{ location.attributes.name }}</dt>
      <dd>{{ location.role | underscoresToCapitalized }}</dd>
    {% endfor %}
  </dl>
  {% else %}
  {{ no_data_message('Conducted in', thing='"location" data') }}
  {% endif %}

  {% if trial.persons.length != 0 %}
  <h2>Related People</h2>
  <dl>
    {% for person in trial.persons %}
      <dt><a href="/persons/{{ person.attributes.id }}">{{ person.attributes.name }}</a></dt>
      <dd>{{ person.role | underscoresToCapitalized }}</dd>
    {% endfor %}
  </dl>
  {% else %}
  {{ no_data_message('Related People', thing='"related people"') }}
  {% endif %}

  {% if trial.organisations.length != 0 %}
  <h2>Related Organisations</h2>
  <dl>
    {% for organisation in trial.organisations %}
      <dt><a href="/organisations/{{ organisation.attributes.id }}">{{ organisation.attributes.name }}</a></dt>
      <dd>{{ organisation.role | underscoresToCapitalized }}</dd>
    {% endfor %}
  </dl>
  {% else %}
  {{ no_data_message('Related Organisations', thing='"related organisations"') }}
  {% endif %}

  <h2>Sources</h2>
  <dl>
    {% for record in trial.records %}
      <dt>{{ record.source.name }}</dt>
      <dd>
        Last updated on
        <a href="/trials/{{ trial.id }}/records/{{ record.id }}">
          <time datetime="{{ record.updated_at }}">
            {{ record.updated_at | formatDate }}
          </time>
        </a>
      </dd>
    {% endfor %}
  </dl>
</aside>
{% endblock %}
